dist: bionic

language: bash # same as minimal
cache:
  directories:
    - $HOME/build/$TRAVIS_REPO_SLUG/../ccache
    - $HOME/build/$TRAVIS_REPO_SLUG/../download

install: 
  - bin/system-setup

addons:
  apt:
    packages:
      - cloud-utils
      - qemu-system
      - openbios-ppc

jobs:
  fast_finish: true # fail once any job fail

env:
  - ARCHES=aarch64
  - ARCHES=x86_64
  - ARCHES=ppc64le
  - ARCHES=arm
  - ARCHES=i386
  - ARCHES=powerpc
  - ARCHES=ppc64

script:
  # we want to test does image boots after build
  - "BOOTTEST=true QUIET=1 bin/build-release ${TRAVIS_TAG:-daily}"

deploy:
  provider: releases
  api_key:
    secure: pDDpZLjpMTA6/qMBfBDchwgHlpZlTUY4aXSY/9cTL8RMaeoMLIHmL1RDJDO1s/LTnjoi8mGQ19Vrf2bMgr8Zt2Q1FETnwmWfxQpZxl7mQ8Pws3lETqCtWKcHr8yTcZJCB2M7vPjJHauPeGZYav7z34hVdroPN9jhkCPRba2egdIFNbqUoiqWn4Wo6bJ2OtD4wPpcfk1lbnCXbURBtCavP1ad1e84bNu3B/7DXlavEUVhqKoIWtL7QFruye8ZFfv7lHOVl09ZG237k+R0xYSwzACnvCvvsS/5Am0VQD7odS0qmckqUqd9m0GmVF2hZtNWYuazCUMaJbQ080S/E/DtbIEMDqdXd39AuOQC+AF39HXVT2StRfVRaZnTX60Lu6t5pPDiYT2c5ZRRjDM7Aw0Sa/zRmizcmvvf0XP+GBsUZX8b1dmDY3qDbRqDL8fVc+0BjYs85CmUoYBKNUUbnz40pwY1bE073X1NJnrqX7FFw+96hY/0cEzLjb8WOoMpaotwYUwDc+NaQJ+3UCh+JUK97rgxTCkPrRD2M+NAOvs1QWudC/TrxKCzV9kDxnTky/+Ds/ybA6Vx3b6+tNjziGA2hK39sMrh+c9bORFrTs4CuJ/RqXQRXZsGTSAzrpxMo8fphvufSvQBkDPkm7pqblFVX/TC882u+XsUmYU7Hi8V180=
  file: "$HOME/build/$TRAVIS_REPO_SLUG/../build-*/release/cirros-*"
  on:
    tags: true
    repo: cirros-dev/cirros
